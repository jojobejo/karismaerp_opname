SELECT
    a.tgl_inputer,
    a.kd_faktur,
    b.nama_customer,
    b.nama_kios,
    b.alamat_kios,
    b.regional,
    a.kd_rute,
    c.keterangan AS keterangan_rute,
    a.kd_barang,
    a.tgl_exp,
    a.no_lot,
    COUNT(*) AS total_barang,
    a.data_sts
FROM tb_pre_do a
INNER JOIN tb_customer b ON b.kd_customer = a.kd_customer
INNER JOIN tb_rutecs c ON c.kd_rute = a.kd_rute
LEFT JOIN tb_detail_do d ON d.kd_faktur = a.kd_faktur
WHERE a.data_sts = '1'
AND d.kd_faktur IS NULL
GROUP BY a.kd_faktur

bantu saya untuk dapat menampilkan semua list faktur yang ada pada tb_pre_do dengan status 1 dan 
apabila pada tb_detail_do terdapat kd_faktur yang sama pada tb_pre_do , maka jangan ditampilkan 
COUNT(*) AS total_barang menampilkan hasil group by , select tb_pre_do berdasarkan kd_faktur , kd_barang



$this->db->select('
    a.tgl_inputer,
    a.kd_faktur,
    b.nama_customer,
    b.nama_kios,
    b.alamat_kios,
    b.regional,
    a.kd_rute,
    c.keterangan AS keterangan_rute,
    COUNT(DISTINCT a.kd_barang) AS total_barang,
    a.data_sts 
');
$this->db->from('tb_pre_do a');
$this->db->join('tb_customer b', 'b.kd_customer = a.kd_customer', 'inner');
$this->db->join('tb_rutecs c', 'c.kd_rute = a.kd_rute', 'inner');
$this->db->join('tb_detail_do d', 'd.kd_faktur = a.kd_faktur', 'left');
$this->db->where('a.data_sts', 1);
$this->db->where('d.kd_faktur IS NULL', null, false);
$this->db->group_by('a.kd_faktur');

$query = $this->db->get();
return $query->result();
